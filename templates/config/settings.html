{% extends "base.html" %}

{% block title %}Configura√ß√µes - Fluxi.IA{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 2rem;">
    <h1 class="title is-3" style="margin-bottom: 0.75rem !important; line-height: 1.2;">
        <i class="fas fa-cog" style="color: #8b5cf6;"></i> Configura√ß√µes do Sistema
    </h1>
    <p class="subtitle is-6" style="color: #6b7280; margin-bottom: 0 !important; line-height: 1.4;">
        Configure API, par√¢metros de IA e prefer√™ncias do sistema
    </p>
</div>
<!-- Provedores LLM -->
<div class="box" style="margin-bottom: 2rem;">
    <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
        <i class="fas fa-server" style="color: #8b5cf6;"></i> Provedores LLM
    </h2>
    
    <form method="POST" action="/configuracoes/salvar-provedores-llm">
        <div class="field">
            <label class="label" style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fas fa-cog"></i> Provedor Padr√£o
            </label>
            <div class="control">
                <div class="select is-fullwidth">
                    <select name="provedor_padrao" style="border-radius: 8px; border: 2px solid #e5e7eb; padding: 0.75rem 1rem;">
                        <option value="openrouter" {% if (config_llm|selectattr('chave', 'equalto', 'llm_provedor_padrao')|map(attribute='valor')|first or 'openrouter') == 'openrouter' %}selected{% endif %}>
                            OpenRouter (Nuvem)
                        </option>
                        <option value="local" {% if (config_llm|selectattr('chave', 'equalto', 'llm_provedor_padrao')|map(attribute='valor')|first) == 'local' %}selected{% endif %}>
                            Provedor Local
                        </option>
                    </select>
                </div>
            </div>
            <p class="help" style="color: #6b7280; margin-top: 0.5rem;">
                Escolha entre provedores em nuvem (OpenRouter) ou locais (LM Studio, llama.cpp, Ollama)
            </p>
        </div>
        
        <div class="field">
            <label class="label" style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fas fa-shield-alt"></i> Fallback para OpenRouter
            </label>
            <div class="control">
                <label class="checkbox">
                    <input type="checkbox" name="fallback_openrouter" value="true" 
                           {% if (config_llm|selectattr('chave', 'equalto', 'llm_fallback_openrouter')|map(attribute='valor')|first or 'true') == 'true' %}checked{% endif %}>
                    Usar OpenRouter como fallback quando provedor local falhar
                </label>
            </div>
        </div>
        
        <div class="field is-grouped">
            <div class="control">
                <button type="submit" class="button is-primary">
                    <span class="icon">
                        <i class="fas fa-save"></i>
                    </span>
                    <span>Salvar Configura√ß√µes</span>
                </button>
            </div>
            <div class="control">
                <a href="/provedores-llm" class="button is-light">
                    <span class="icon">
                        <i class="fas fa-server"></i>
                    </span>
                    <span>Gerenciar Provedores</span>
                </a>
            </div>
        </div>
    </form>
</div>

<!-- OpenRouter API -->
<div class="box" style="margin-bottom: 2rem;">
    <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
        <i class="fas fa-key" style="color: #f59e0b;"></i> OpenRouter API
    </h2>
        
        <form method="POST" action="/configuracoes/salvar-openrouter">
        <div class="field">
            <label class="label" style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fas fa-key"></i> API Key *
            </label>
            <div class="control has-icons-left">
                <input class="input" type="password" name="api_key" placeholder="sk-or-v1-..." 
                       value="{{ config_openrouter|selectattr('chave', 'equalto', 'openrouter_api_key')|map(attribute='valor')|first or '' }}"
                       style="border-radius: 8px; border: 2px solid #e5e7eb; padding: 0.75rem 1rem; font-family: monospace;">
                <span class="icon is-small is-left" style="color: #f59e0b;">
                    <i class="fas fa-key"></i>
                </span>
            </div>
            <p class="help" style="color: #6b7280; margin-top: 0.5rem;">
                üîó Obtenha em <a href="https://openrouter.ai/keys" target="_blank" style="color: #C75B9B; font-weight: 600;">openrouter.ai/keys</a>
            </p>
        </div>
            
        <div class="field">
            <label class="label" style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">
                <i class="fas fa-brain"></i> Modelo Padr√£o
            </label>
            <div class="control">
                <input class="input" type="text" name="modelo_padrao" placeholder="google/gemini-2.0-flash-001"
                       value="{{ config_openrouter|selectattr('chave', 'equalto', 'openrouter_modelo_padrao')|map(attribute='valor')|first or '' }}"
                       style="border-radius: 8px; border: 2px solid #e5e7eb; padding: 0.75rem 1rem; font-family: monospace;">
            </div>
            <p class="help" style="color: #6b7280; margin-top: 0.5rem;">
                Ex: google/gemini-2.0-flash-001, openai/gpt-4, anthropic/claude-3.5-sonnet
            </p>
        </div>
            
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <button type="submit" name="acao" value="testar" class="button is-medium" style="border: 2px solid #3b82f6; color: #3b82f6; font-weight: 600; border-radius: 8px;">
                <span class="icon"><i class="fas fa-plug"></i></span>
                <span>Testar Conex√£o</span>
            </button>
            <button type="submit" name="acao" value="salvar" class="button is-medium" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: 600; border-radius: 8px;">
                <span class="icon"><i class="fas fa-save"></i></span>
                <span>Salvar</span>
            </button>
        </div>
        </form>
    </div>

<!-- Par√¢metros LLM -->
<div class="box" style="margin-bottom: 2rem;">
    <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
        <i class="fas fa-sliders-h" style="color: #8b5cf6;"></i> Par√¢metros IA Padr√£o
    </h2>
        
        <form method="POST" action="/configuracoes/salvar-parametros-llm">
            <div class="columns">
                <div class="column">
                    <div class="field">
                        <label class="label">Temperatura (0.0 - 2.0)</label>
                        <div class="control">
                            <input class="input" type="number" step="0.1" min="0" max="2" 
                                   name="temperatura"
                                   value="{{ config_openrouter|selectattr('chave', 'equalto', 'openrouter_temperatura')|map(attribute='valor')|first or '0.7' }}">
                        </div>
                        <p class="help">Controla a criatividade das respostas</p>
                    </div>
                </div>
                
                <div class="column">
                    <div class="field">
                        <label class="label">Max Tokens</label>
                        <div class="control">
                            <input class="input" type="number" step="100" min="100" max="8000" 
                                   name="max_tokens"
                                   value="{{ config_openrouter|selectattr('chave', 'equalto', 'openrouter_max_tokens')|map(attribute='valor')|first or '2000' }}">
                        </div>
                        <p class="help">Tamanho m√°ximo da resposta</p>
                    </div>
                </div>
                
                <div class="column">
                    <div class="field">
                        <label class="label">Top P (0.0 - 1.0)</label>
                        <div class="control">
                            <input class="input" type="number" step="0.1" min="0" max="1" 
                                   name="top_p"
                                   value="{{ config_openrouter|selectattr('chave', 'equalto', 'openrouter_top_p')|map(attribute='valor')|first or '1.0' }}">
                        </div>
                        <p class="help">Controla a diversidade</p>
                    </div>
                </div>
            </div>
            
        <div class="field">
            <div class="control">
                <button type="submit" class="button is-medium" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: 600; border-radius: 8px;">
                    <span class="icon"><i class="fas fa-save"></i></span>
                    <span>Salvar Par√¢metros</span>
                </button>
            </div>
        </div>
        </form>
    </div>

<!-- Configura√ß√µes do Agente Padr√£o -->
<div class="box" style="margin-bottom: 2rem;">
    <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
        <i class="fas fa-robot" style="color: #5B4E9B;"></i> Agente Padr√£o (Template)
    </h2>
    <p style="color: #6b7280; margin-bottom: 1.5rem; line-height: 1.7;">
        <i class="fas fa-info-circle"></i> Estes valores ser√£o usados ao criar novos agentes
    </p>
        
        <form method="POST" action="/configuracoes/salvar-agente">
            <div class="field">
                <label class="label">Papel</label>
                <div class="control">
                    <input class="input" type="text" name="papel" 
                           value="{{ config_agente|selectattr('chave', 'equalto', 'agente_papel_padrao')|map(attribute='valor')|first or 'assistente pessoal' }}">
                </div>
                <p class="help">Quem o agente √© (ex: "consultor de vendas", "assistente pessoal")</p>
            </div>
            
            <div class="field">
                <label class="label">Objetivo</label>
                <div class="control">
                    <textarea class="textarea" name="objetivo" rows="2">{{ config_agente|selectattr('chave', 'equalto', 'agente_objetivo_padrao')|map(attribute='valor')|first or 'ajudar o usu√°rio com suas d√∫vidas e tarefas' }}</textarea>
                </div>
                <p class="help">Miss√£o principal do agente</p>
            </div>
            
            <div class="field">
                <label class="label">Pol√≠ticas</label>
                <div class="control">
                    <textarea class="textarea" name="politicas" rows="2">{{ config_agente|selectattr('chave', 'equalto', 'agente_politicas_padrao')|map(attribute='valor')|first or 'ser educado, respeitoso e prestativo' }}</textarea>
                </div>
                <p class="help">O que evitar ou respeitar</p>
            </div>
            
            <div class="field">
                <label class="label">Tarefa</label>
                <div class="control">
                    <textarea class="textarea" name="tarefa" rows="2">{{ config_agente|selectattr('chave', 'equalto', 'agente_tarefa_padrao')|map(attribute='valor')|first or 'responder perguntas de forma clara e objetiva' }}</textarea>
                </div>
                <p class="help">O que deve fazer na pr√°tica</p>
            </div>
            
            <div class="field">
                <label class="label">Objetivo Expl√≠cito</label>
                <div class="control">
                    <textarea class="textarea" name="objetivo_explicito" rows="2">{{ config_agente|selectattr('chave', 'equalto', 'agente_objetivo_explicito_padrao')|map(attribute='valor')|first or 'fornecer informa√ß√µes √∫teis e precisas' }}</textarea>
                </div>
                <p class="help">Como deve entregar valor</p>
            </div>
            
            <div class="field">
                <label class="label">P√∫blico-Alvo</label>
                <div class="control">
                    <input class="input" type="text" name="publico" 
                           value="{{ config_agente|selectattr('chave', 'equalto', 'agente_publico_padrao')|map(attribute='valor')|first or 'usu√°rios em geral' }}">
                </div>
                <p class="help">Para quem est√° falando</p>
            </div>
            
            <div class="field">
                <label class="label">Restri√ß√µes</label>
                <div class="control">
                    <textarea class="textarea" name="restricoes" rows="2">{{ config_agente|selectattr('chave', 'equalto', 'agente_restricoes_padrao')|map(attribute='valor')|first or 'responder em portugu√™s brasileiro, ser conciso' }}</textarea>
                </div>
                <p class="help">Limites t√©cnicos e de estilo</p>
            </div>
            
        <div class="field">
            <div class="control">
                <button type="submit" class="button is-medium" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: 600; border-radius: 8px;">
                    <span class="icon"><i class="fas fa-save"></i></span>
                    <span>Salvar Configura√ß√µes</span>
                </button>
            </div>
        </div>
        </form>
    </div>

<!-- Configura√ß√µes Gerais -->
<div class="box" style="margin-bottom: 2rem;">
    <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
        <i class="fas fa-cogs" style="color: #6b7280;"></i> Configura√ß√µes Gerais
    </h2>
        
        <form method="POST" action="/configuracoes/salvar-geral">
            <div class="field">
                <label class="label">Diret√≥rio de Uploads</label>
                <div class="control">
                    <input class="input" type="text" name="diretorio_uploads" 
                           value="{{ config_geral|selectattr('chave', 'equalto', 'sistema_diretorio_uploads')|map(attribute='valor')|first or './uploads' }}">
                </div>
            </div>
            
            <div class="field">
                <label class="label">Tamanho M√°ximo de Imagem (MB)</label>
                <div class="control">
                    <input class="input" type="number" name="max_tamanho_imagem_mb" 
                           value="{{ config_geral|selectattr('chave', 'equalto', 'sistema_max_tamanho_imagem_mb')|map(attribute='valor')|first or '10' }}">
                </div>
            </div>
            
        <div class="field">
            <div class="control">
                <button type="submit" class="button is-medium" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: 600; border-radius: 8px;">
                    <span class="icon"><i class="fas fa-save"></i></span>
                    <span>Salvar Configura√ß√µes</span>
                </button>
            </div>
        </div>
    </form>
</div>

{% endblock %}
