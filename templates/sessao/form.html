{% extends "base.html" %}

{% block title %}{{ titulo }} - Fluxi.IA{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 2rem;">
    <nav class="breadcrumb" aria-label="breadcrumbs" style="margin-bottom: 0.75rem !important;">
        <ul style="margin-bottom: 0 !important;">
            <li><a href="/sessoes" style="color: #6b7280;"><i class="fas fa-home"></i> Sessões</a></li>
            <li class="is-active"><a style="color: #C75B9B;">{{ titulo }}</a></li>
        </ul>
    </nav>
    <h1 class="title is-3" style="margin-bottom: 0.75rem !important; line-height: 1.2;">
        <i class="{% if acao == 'criar' %}fas fa-plus-circle{% else %}fas fa-edit{% endif %}" style="color: #C75B9B;"></i> {{ titulo }}
    </h1>
    <p class="subtitle is-6" style="color: #6b7280; margin-bottom: 0 !important; line-height: 1.4;">
        Configure seu canal de comunicação WhatsApp
    </p>
</div>

<div class="columns">
    <div class="column is-8">
        <form method="POST" action="{% if acao == 'criar' %}/sessoes/criar{% else %}/sessoes/{{ sessao.id }}/atualizar{% endif %}">

            <!-- Informações da Sessão -->
            <div class="box" style="margin-bottom: 2rem;">
                <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
                    <i class="fas fa-info-circle" style="color: #C75B9B;"></i> Informações da Sessão
                </h2>
                
                <div class="field">
                    <label class="label" style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">
                        Nome da Sessão *
                    </label>
                    <div class="control has-icons-left">
                        <input class="input" type="text" name="nome" required
                               value="{% if sessao %}{{ sessao.nome }}{% endif %}"
                               placeholder="Ex: Atendimento Principal, Suporte Técnico, Vendas"
                               style="border-radius: 8px; border: 2px solid #e5e7eb; padding: 0.75rem 1rem;">
                        <span class="icon is-small is-left" style="color: #C75B9B;">
                            <i class="fas fa-tag"></i>
                        </span>
                    </div>
                    <p class="help" style="color: #6b7280; margin-top: 0.5rem;">
                        <i class="fas fa-info-circle"></i> Nome único para identificar este canal WhatsApp
                    </p>
                </div>
            </div>

            {% if acao == 'criar' %}
            <!-- Configuração do Agente Padrão -->
            <div class="box" style="margin-bottom: 2rem;">
                <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
                    <i class="fas fa-robot" style="color: #8b5cf6;"></i> Configuração do Agente Padrão
                </h2>

                <p style="color: #6b7280; margin-bottom: 1.5rem; line-height: 1.6;">
                    Ao criar uma sessão, um agente padrão será gerado automaticamente com as configurações abaixo. Ajuste conforme desejado.
                </p>

                <div class="field">
                    <label class="label">Papel do Agente *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_papel" rows="2" required>{{ config_agente.papel }}</textarea>
                    </div>
                    <p class="help">Descreva o papel principal deste agente.</p>
                </div>

                <div class="field">
                    <label class="label">Objetivo do Agente *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_objetivo" rows="2" required>{{ config_agente.objetivo }}</textarea>
                    </div>
                    <p class="help">Explique qual objetivo este agente deve alcançar.</p>
                </div>

                <div class="field">
                    <label class="label">Políticas do Agente *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_politicas" rows="2" required>{{ config_agente.politicas }}</textarea>
                    </div>
                    <p class="help">Regras e diretrizes que o agente deve seguir.</p>
                </div>

                <div class="field">
                    <label class="label">Tarefa do Agente *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_tarefa" rows="2" required>{{ config_agente.tarefa }}</textarea>
                    </div>
                    <p class="help">Principais atividades que o agente deve realizar.</p>
                </div>

                <div class="field">
                    <label class="label">Objetivo Explícito *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_objetivo_explicito" rows="2" required>{{ config_agente.objetivo_explicito }}</textarea>
                    </div>
                    <p class="help">Mensagem direta que explicita o objetivo do agente.</p>
                </div>

                <div class="field">
                    <label class="label">Público-alvo *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_publico" rows="2" required>{{ config_agente.publico }}</textarea>
                    </div>
                    <p class="help">Para quem o agente irá responder (clientes, leads, equipe interna, etc.).</p>
                </div>

                <div class="field">
                    <label class="label">Restrições *</label>
                    <div class="control">
                        <textarea class="textarea" name="agente_restricoes" rows="2" required>{{ config_agente.restricoes }}</textarea>
                    </div>
                    <p class="help">Limitações e orientações que o agente deve respeitar.</p>
                </div>
            </div>
            {% endif %}

            <!-- Configurações -->
            <div class="box" style="margin-bottom: 2rem;">
                <h2 class="title is-5" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
                    <i class="fas fa-cog" style="color: #6b7280;"></i> Configurações
                </h2>
                
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 12px; padding: 1.5rem; border: 2px solid #10b981;">
                    <label class="checkbox" style="display: flex; align-items: start; gap: 1rem; cursor: pointer;">
                        <input type="checkbox" name="auto_responder" value="true"
                               {% if not sessao or sessao.auto_responder %}checked{% endif %}
                               style="margin-top: 0.25rem; transform: scale(1.2);">
                        <div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="width: 40px; height: 40px; border-radius: 8px; background: #10b981; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-robot" style="color: white; font-size: 1.125rem;"></i>
                                </div>
                                <strong style="color: #1f2937; font-size: 1.125rem;">Auto-responder com IA</strong>
                            </div>
                            <p style="color: #166534; font-size: 0.9375rem; line-height: 1.7; font-weight: 500;">
                                Quando ativado, o <strong>agente ativo</strong> responderá automaticamente todas as mensagens recebidas nesta sessão usando inteligência artificial.
                            </p>
                            <p style="color: #166534; font-size: 0.8125rem; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(16, 185, 129, 0.3);">
                                <i class="fas fa-lightbulb"></i> <strong>Dica:</strong> Desative se quiser responder manualmente ou se ainda não configurou um agente.
                            </p>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Botões -->
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button type="submit" class="button is-primary is-medium" style="background: linear-gradient(135deg, #C75B9B 0%, #5B4E9B 100%); border: none; border-radius: 8px; font-weight: 600; padding: 0.75rem 2rem;">
                    <span class="icon"><i class="fas fa-save"></i></span>
                    <span>{% if acao == 'criar' %}Criar Sessão{% else %}Salvar Alterações{% endif %}</span>
                </button>
                <a href="/sessoes" class="button is-medium" style="border-radius: 8px; font-weight: 600; padding: 0.75rem 2rem;">
                    <span class="icon"><i class="fas fa-arrow-left"></i></span>
                    <span>Voltar</span>
                </a>
            </div>
        </form>
    </div>

    <!-- Sidebar de Ajuda -->
    <div class="column is-4">
        <div class="box" style="position: sticky; top: 2rem; background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border: 2px solid #e5e7eb;">
            <h3 class="title is-5" style="margin-bottom: 1rem;">
                <i class="fas fa-lightbulb" style="color: #f59e0b;"></i> Dicas
            </h3>
            
            <div style="display: grid; gap: 1rem;">
                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #C75B9B;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">
                        <i class="fas fa-tag"></i> Nome da Sessão
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280; line-height: 1.6;">
                        Use nomes descritivos como "Atendimento 24h", "Vendas", "Suporte" para identificar facilmente cada canal.
                    </p>
                </div>

                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #10b981;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">
                        <i class="fas fa-robot"></i> Agentes
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280; line-height: 1.6;">
                        Após criar a sessão, você poderá adicionar agentes com diferentes personalidades para responder neste canal.
                    </p>
                </div>

                <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #3b82f6;">
                    <p style="font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">
                        <i class="fas fa-plug"></i> Conexão
                    </p>
                    <p style="font-size: 0.875rem; color: #6b7280; line-height: 1.6;">
                        Conecte a sessão ao WhatsApp usando QR Code ou pair code após a criação.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer de Documentação -->
<div class="box" style="background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border: 2px solid #e5e7eb; margin-top: 3rem;">
    <div style="display: flex; gap: 2rem; align-items: start; flex-wrap: wrap;">
        <div style="flex-shrink: 0;">
            <div style="width: 64px; height: 64px; border-radius: 12px; background: linear-gradient(135deg, rgba(199, 91, 155, 0.1) 0%, rgba(91, 78, 155, 0.1) 100%); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-book" style="font-size: 1.75rem; color: #C75B9B;"></i>
            </div>
        </div>
        <div style="flex: 1; min-width: 300px;">
            <h3 style="font-size: 1.125rem; font-weight: 700; color: #1f2937; margin-bottom: 0.75rem;">
                <i class="fas fa-info-circle"></i> O que é uma Sessão?
            </h3>
            <div style="color: #4b5563; line-height: 1.7; font-size: 0.9375rem;">
                <p style="margin-bottom: 1rem;">
                    <strong style="color: #1f2937;">Sessão = Canal WhatsApp.</strong> É a conexão física com uma conta do WhatsApp. Pense na sessão como o "telefone" do seu sistema.
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.25rem;"></i>
                        <div>
                            <strong style="color: #1f2937;">Uma sessão</strong> por número WhatsApp
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.25rem;"></i>
                        <div>
                            <strong style="color: #1f2937;">Múltiplos agentes</strong> podem usar a mesma sessão
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.25rem;"></i>
                        <div>
                            <strong style="color: #1f2937;">Agente ativo</strong> responde as mensagens automaticamente
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
