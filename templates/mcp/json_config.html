{% extends "base.html" %}

{% block title %}Conectar MCP - {{ agente.nome }} - Fluxi.IA{% endblock %}

{% block content %}
<div class="container is-max-desktop">
    <div class="box">
        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <h1 class="title is-4">Conectar MCP</h1>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <a href="/mcp/agente/{{ agente.id }}/clients" class="button is-light">
                        <span class="icon"><i class="fas fa-arrow-left"></i></span>
                        <span>Voltar</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="content">
            <p class="subtitle is-6">
                Cole a configuração JSON do servidor MCP que deseja conectar. 
                Use os exemplos abaixo como referência ou cole sua própria configuração.
            </p>
        </div>

        <form method="POST" action="/api/mcp/one-click/install">
            <div class="field">
                <label class="label">Nome do Servidor</label>
                <div class="control">
                    <input class="input" type="text" name="nome" placeholder="Ex: DeepWiki, Time Server, etc.">
                </div>
                <p class="help">Nome personalizado para identificar este servidor MCP</p>
            </div>

            <div class="field">
                <label class="label">Descrição (Opcional)</label>
                <div class="control">
                    <textarea class="textarea" name="descricao" placeholder="Descrição do servidor MCP"></textarea>
                </div>
            </div>

            <div class="field">
                <label class="label">Configuração JSON</label>
                <div class="control">
                    <textarea class="textarea" name="json_config" rows="10" placeholder='Cole aqui a configuração JSON do servidor MCP...' required></textarea>
                </div>
                <p class="help">
                    Cole a configuração JSON no formato <code>{"mcpServers": {...}}</code>
                </p>
            </div>

            <input type="hidden" name="agente_id" value="{{ agente.id }}">

            <div class="field">
                <div class="control">
                    <button type="submit" class="button is-primary is-fullwidth">
                        <span class="icon"><i class="fas fa-plug"></i></span>
                        <span>Conectar MCP</span>
                    </button>
                </div>
            </div>
        </form>

        <hr>

        <div class="content">
            <h3 class="title is-5">Exemplos de Configuração</h3>
            <p class="subtitle is-6">Clique em um exemplo para usar como base:</p>
            
            {% for exemplo in exemplos %}
            <div class="box">
                <div class="level">
                    <div class="level-left">
                        <div class="level-item">
                            <h4 class="title is-6">{{ exemplo.nome }}</h4>
                        </div>
                    </div>
                    <div class="level-right">
                        <div class="level-item">
                            <form method="POST" action="/api/mcp/one-click/install" style="display: inline;" onsubmit="return confirm('Conectar com {{ exemplo.nome }}?')">
                                <input type="hidden" name="agente_id" value="{{ agente.id }}">
                                <input type="hidden" name="nome" value="{{ exemplo.nome }}">
                                <input type="hidden" name="descricao" value="Configuração automática via exemplo">
                                <input type="hidden" name="json_config" value="{{ exemplo.config | tojson }}">
                                <button type="submit" class="button is-small is-info">
                                    <span class="icon"><i class="fas fa-bolt"></i></span>
                                    <span>Usar</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <pre class="is-size-7"><code>{{ exemplo.config | tojson(indent=2) }}</code></pre>
            </div>
            {% endfor %}
        </div>

        <div class="content">
            <h3 class="title is-5">Tipos de Transporte Suportados</h3>
            
            <div class="columns">
                <div class="column">
                    <div class="box">
                        <h4 class="title is-6">SSE (Server-Sent Events)</h4>
                        <p class="subtitle is-7">Recomendado para integrações com Claude</p>
                        <pre class="is-size-7"><code>{
  "mcpServers": {
    "servidor": {
      "serverUrl": "https://exemplo.com/sse"
    }
  }
}</code></pre>
                    </div>
                </div>
                
                <div class="column">
                    <div class="box">
                        <h4 class="title is-6">Streamable HTTP</h4>
                        <p class="subtitle is-7">Novo protocolo, compatível com Cloudflare</p>
                        <pre class="is-size-7"><code>{
  "mcpServers": {
    "servidor": {
      "url": "https://exemplo.com/mcp"
    }
  }
}</code></pre>
                    </div>
                </div>
                
                <div class="column">
                    <div class="box">
                        <h4 class="title is-6">STDIO (Comando Local)</h4>
                        <p class="subtitle is-7">Para servidores executados localmente</p>
                        <pre class="is-size-7"><code>{
  "mcpServers": {
    "servidor": {
      "command": "uvx",
      "args": ["mcp-server-exemplo"],
      "env": {
        "API_KEY": "sua_chave"
      }
    }
  }
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-resize textarea
document.querySelector('textarea[name="json_config"]').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = this.scrollHeight + 'px';
});
</script>
{% endblock %}
