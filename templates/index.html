{% extends "base.html" %}

{% block title %}Dashboard - Fluxi{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="title is-3">
        <i class="fas fa-tachometer-alt"></i> Dashboard
    </h1>
    <p class="subtitle is-5">
        Bem-vindo ao Fluxi - Seu Assistente Pessoal WhatsApp
    </p>
</div>

<div class="content-wrapper">
    <!-- Métricas Rápidas -->
    <div class="columns is-multiline">
        <div class="column is-6-mobile is-3-tablet">
            <div class="card metric-card">
                <span class="icon is-large has-text-info mb-3">
                    <i class="fas fa-layer-group fa-2x"></i>
                </span>
                <div class="metric-value">{{ metricas.sessoes.total }}</div>
                <div class="metric-label">Sessões Totais</div>
            </div>
        </div>
        
        <div class="column is-6-mobile is-3-tablet">
            <div class="card metric-card">
                <span class="icon is-large has-text-success mb-3">
                    <i class="fas fa-check-circle fa-2x"></i>
                </span>
                <div class="metric-value">{{ metricas.sessoes.conectadas }}</div>
                <div class="metric-label">Conectadas</div>
            </div>
        </div>
        
        <div class="column is-6-mobile is-3-tablet">
            <div class="card metric-card">
                <span class="icon is-large has-text-link mb-3">
                    <i class="fas fa-comments fa-2x"></i>
                </span>
                <div class="metric-value">{{ metricas.mensagens.total }}</div>
                <div class="metric-label">Mensagens</div>
            </div>
        </div>
        
        <div class="column is-6-mobile is-3-tablet">
            <div class="card metric-card">
                <span class="icon is-large has-text-warning mb-3">
                    <i class="fas fa-users fa-2x"></i>
                </span>
                <div class="metric-value">{{ metricas.performance.clientes_unicos }}</div>
                <div class="metric-label">Clientes</div>
            </div>
        </div>
    </div>

    <!-- Ações Rápidas -->
    <div class="box mb-5">
        <h2 class="title is-4 mb-4">
            <i class="fas fa-bolt"></i> Ações Rápidas
        </h2>
        
        <div class="columns is-mobile is-multiline">
            <div class="column is-6-mobile is-3-tablet">
                <a href="/sessoes/nova" class="button is-primary is-fullwidth">
                    <span class="icon"><i class="fab fa-whatsapp"></i></span>
                    <span>Nova Sessão</span>
                </a>
            </div>
            
            <div class="column is-6-mobile is-3-tablet">
                <a href="/ferramentas/wizard/step1" class="button is-info is-fullwidth">
                    <span class="icon"><i class="fas fa-magic"></i></span>
                    <span>Nova Ferramenta</span>
                </a>
            </div>
            
            <div class="column is-6-mobile is-3-tablet">
                <a href="/configuracoes" class="button is-link is-fullwidth">
                    <span class="icon"><i class="fas fa-cog"></i></span>
                    <span>Configurações</span>
                </a>
            </div>
            
            <div class="column is-6-mobile is-3-tablet">
                <a href="/metricas" class="button is-success is-fullwidth">
                    <span class="icon"><i class="fas fa-chart-line"></i></span>
                    <span>Métricas</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Sessões Recentes -->
    <div class="box mb-5">
        <div class="level mb-4">
            <div class="level-left">
                <div class="level-item">
                    <h2 class="title is-4 mb-0">
                        <i class="fab fa-whatsapp"></i> Sessões Recentes
                    </h2>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <a href="/sessoes" class="button is-small is-outlined is-primary">
                        Ver todas
                        <span class="icon is-small"><i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>
            </div>
        </div>
        
        {% if sessoes %}
        <div class="is-scrollable-x">
            <table class="table is-fullwidth is-hoverable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Telefone</th>
                        <th>Status</th>
                        <th>Última Conexão</th>
                        <th class="has-text-centered">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sessao in sessoes[:5] %}
                    <tr>
                        <td>
                            <strong>{{ sessao.nome }}</strong>
                        </td>
                        <td>{{ sessao.telefone or '-' }}</td>
                        <td>
                            <span class="status-badge status-{{ sessao.status }}">
                                {% if sessao.status == 'conectado' %}
                                    <i class="fas fa-check-circle"></i>
                                {% elif sessao.status == 'desconectado' %}
                                    <i class="fas fa-times-circle"></i>
                                {% else %}
                                    <i class="fas fa-spinner fa-pulse"></i>
                                {% endif %}
                                {{ sessao.status }}
                            </span>
                        </td>
                        <td>{{ sessao.ultima_conexao.strftime('%d/%m/%Y %H:%M') if sessao.ultima_conexao else '-' }}</td>
                        <td>
                            <div class="buttons is-centered">
                                <a href="/sessoes/{{ sessao.id }}/detalhes" class="button is-info is-small" title="Detalhes">
                                    <span class="icon"><i class="fas fa-eye"></i></span>
                                </a>
                                <a href="/agentes/sessao/{{ sessao.id }}" class="button is-warning is-small" title="Agentes">
                                    <span class="icon"><i class="fas fa-user-robot"></i></span>
                                </a>
                                <a href="/mensagens/sessao/{{ sessao.id }}" class="button is-link is-small" title="Mensagens">
                                    <span class="icon"><i class="fas fa-comments"></i></span>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="notification is-info is-light">
            <div class="columns is-mobile is-vcentered">
                <div class="column is-narrow">
                    <span class="icon is-large">
                        <i class="fas fa-info-circle fa-2x"></i>
                    </span>
                </div>
                <div class="column">
                    <p class="has-text-weight-semibold">Nenhuma sessão criada ainda</p>
                    <p>Crie sua primeira sessão para começar a usar o Fluxi</p>
                    <a href="/sessoes/nova" class="button is-info mt-3">
                        <span class="icon"><i class="fas fa-plus"></i></span>
                        <span>Criar Primeira Sessão</span>
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Status do Sistema -->
    <div class="columns is-multiline">
        <div class="column is-12-mobile is-6-tablet">
            <div class="box">
                <h2 class="title is-5 mb-4">
                    <i class="fas fa-server"></i> Status do Sistema
                </h2>
                
                <div class="content">
                    <div class="mb-3 p-3" style="background: #f8f9fa; border-radius: 8px;">
                        <div class="level is-mobile mb-0">
                            <div class="level-left">
                                <div class="level-item">
                                    <strong>API OpenRouter</strong>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    {% if api_configurada %}
                                    <span class="tag is-success is-medium">
                                        <i class="fas fa-check-circle mr-2"></i> Configurada
                                    </span>
                                    {% else %}
                                    <span class="tag is-danger is-medium">
                                        <i class="fas fa-exclamation-circle mr-2"></i> Não Configurada
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3 p-3" style="background: #f8f9fa; border-radius: 8px;">
                        <div class="level is-mobile mb-0">
                            <div class="level-left">
                                <div class="level-item">
                                    <strong>Sessões Ativas</strong>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <span class="tag is-info is-medium">{{ metricas.sessoes.ativas }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-3" style="background: #f8f9fa; border-radius: 8px;">
                        <div class="level is-mobile mb-0">
                            <div class="level-left">
                                <div class="level-item">
                                    <strong>Taxa de Sucesso</strong>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <span class="tag is-success is-medium">{{ metricas.performance.taxa_sucesso }}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="column is-12-mobile is-6-tablet">
            <div class="box">
                <h2 class="title is-5 mb-4">
                    <i class="fas fa-info-circle"></i> Sobre o Fluxi
                </h2>
                
                <div class="content">
                    <p>
                        <strong>Fluxi</strong> é um assistente pessoal inteligente que integra 
                        WhatsApp com modelos de linguagem através do OpenRouter.
                    </p>
                    
                    <p class="has-text-weight-semibold mb-2">Recursos:</p>
                    <div class="columns is-mobile is-multiline">
                        <div class="column is-6">
                            <div class="p-2" style="background: #f0f7ff; border-radius: 8px;">
                                <i class="fas fa-whatsapp has-text-success"></i> Múltiplas sessões
                            </div>
                        </div>
                        <div class="column is-6">
                            <div class="p-2" style="background: #f0f7ff; border-radius: 8px;">
                                <i class="fas fa-robot has-text-info"></i> Agentes LLM
                            </div>
                        </div>
                        <div class="column is-6">
                            <div class="p-2" style="background: #f0f7ff; border-radius: 8px;">
                                <i class="fas fa-image has-text-warning"></i> Suporte a imagens
                            </div>
                        </div>
                        <div class="column is-6">
                            <div class="p-2" style="background: #f0f7ff; border-radius: 8px;">
                                <i class="fas fa-tools has-text-link"></i> Ferramentas custom
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
